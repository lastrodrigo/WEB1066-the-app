language: java
dist: trusty
jdk: oraclejdk8

env:
  COVERAGE=0.3

script:
  - ./gradlew clean jar
  - ./gradlew jacocoTestReport
  - find . -name jacocoTestReport.csv|xargs cat|awk -F',' '{print "$3" "$4" "$5"}'
  - ${COVERAGE} ./gradlew test jacocoTestCoverageVerification

after_script:
  - ./gradlew test

deploy:
  provider: script
  script: bash scripts/deploy.sh
  # on:
  #   branch: master
